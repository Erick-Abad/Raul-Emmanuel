<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Generador ¬∑ Baby Shower Raul Emmanuel</title>

  <!-- Bootstrap 5 + Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  
  <style>
    :root{
      --cream: #fbf6ee;
      --bone:  #fffdf8;
      --ink: rgba(45,62,80,.92);
      --sand: #d7c2a0;
      --sky: #7fbfe8;
    }
    body{
      background: linear-gradient(180deg, var(--cream), var(--bone));
      font-family: 'Montserrat', sans-serif;
      min-height: 100vh;
      position: relative;
    }
    body::before{
      content:"";
      position: fixed;
      inset: 0;
      z-index: 0;
      pointer-events:none;
      background:
        radial-gradient(900px circle at 15% 12%, rgba(127,191,232,.22), transparent 55%),
        radial-gradient(900px circle at 85% 18%, rgba(212,175,55,.10), transparent 55%),
        radial-gradient(900px circle at 50% 100%, rgba(231,220,203,.28), transparent 55%);
    }
    .card-generator{
      background: rgba(255,255,255,.78);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255,255,255,.65);
      border-radius: 32px;
      box-shadow: 0 18px 55px rgba(0,0,0,.08);
      position: relative;
      z-index: 1;
    }
    .preview-iframe{
      width:100%;
      height: 620px;
      border-radius: 28px;
      border: 1px solid rgba(255,255,255,.6);
      background: white;
    }
    .btn-wa{
      background: linear-gradient(180deg, #25D366, #128C7E);
      color: white;
      border: none;
    }
    .btn-wa:hover{
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 18px 40px rgba(37,211,102,.3);
    }
  </style>
</head>
<body class="p-3">
  <div class="container py-4" style="position: relative; z-index: 1;">
    <div class="row g-4">
      <!-- Panel de control -->
      <div class="col-lg-5">
        <div class="card-generator p-4">
          <div class="d-flex align-items-center gap-3 mb-4">
            <i class="bi bi-gift fs-1" style="color: #a87e2c;"></i>
            <h2 class="fw-black" style="background: linear-gradient(180deg,#fff6d5,#e6c76a 35%,#c9a13f 60%,#a87e2c); -webkit-background-clip:text; -webkit-text-fill-color:transparent;">Generador de invitaci√≥n</h2>
          </div>

          <form id="genForm">
            <div class="mb-4">
              <label class="fw-bold mb-2"><i class="bi bi-people-fill me-2"></i>N√∫mero de invitados</label>
              <select class="form-select rounded-pill" id="qtySelect">
                <option value="1">1 persona</option>
                <option value="2">2 personas</option>
                <option value="3">3 personas</option>
              </select>
            </div>

            <div class="mb-4">
              <label class="fw-bold mb-2"><i class="bi bi-whatsapp me-2"></i>Tel√©fono del invitado</label>
              <input type="tel" class="form-control rounded-pill" id="phoneInput" placeholder="09xxxxxxxx o 593xxxxxxxxx">
            </div>

            <div class="alert alert-danger d-none" id="errBox"></div>

            <div class="d-grid gap-2 mb-3">
              <button type="button" class="btn btn-light rounded-pill py-3" id="copyBtn">
                <i class="bi bi-files me-2"></i>Copiar enlace
              </button>
              <button type="button" class="btn btn-light rounded-pill py-3" id="openBtn">
                <i class="bi bi-box-arrow-up-right me-2"></i>Abrir invitaci√≥n
              </button>
              <button type="submit" class="btn btn-wa rounded-pill py-3">
                <i class="bi bi-whatsapp me-2"></i>Enviar por WhatsApp
              </button>
            </div>

            <div class="text-center small opacity-75 mt-3">
              <i class="bi bi-shield-check me-1"></i>M√°ximo 3 invitados por enlace
            </div>
          </form>
        </div>
      </div>

      <!-- Vista previa -->
      <div class="col-lg-7">
        <div class="card-generator p-3">
          <div class="d-flex align-items-center gap-2 mb-3">
            <span class="badge rounded-pill" style="background: rgba(127,191,232,.2); color:#2b4f6e; padding:8px 16px;" id="previewBadge">1 persona</span>
            <span class="fw-light"><i class="bi bi-eye me-1"></i>Vista previa</span>
          </div>
          <iframe class="preview-iframe" id="previewFrame" title="Vista previa"></iframe>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast para copiar -->
  <div class="toast-container position-fixed bottom-0 end-0 p-3">
    <div class="toast align-items-center border-0" id="copyToast" role="alert" style="background: rgba(255,255,255,.9); backdrop-filter: blur(8px);">
      <div class="d-flex">
        <div class="toast-body fw-bold" id="copyToastText">Copiado ‚úÖ</div>
        <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast"></button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // CONFIGURACI√ìN
    const CONFIG = {
      WA_MESSAGE_PREFIX: "Hola üòä Te comparto la invitaci√≥n del Baby Shower: ",
      ORGANIZER_PHONE: "593999999999" // Cambia por tu n√∫mero
    };

    // GENERATOR JS
    (function () {
      const form = document.getElementById("genForm");
      const qtySelect = document.getElementById("qtySelect");
      const phoneInput = document.getElementById("phoneInput");
      const errBox = document.getElementById("errBox");

      const previewFrame = document.getElementById("previewFrame");
      const previewBadge = document.getElementById("previewBadge");

      const copyBtn = document.getElementById("copyBtn");
      const openBtn = document.getElementById("openBtn");

      const toastEl = document.getElementById("copyToast");
      const toastText = document.getElementById("copyToastText");
      const toast = new bootstrap.Toast(toastEl, { delay: 1600 });

      function showErr(msg) {
        errBox.textContent = msg;
        errBox.classList.remove("d-none");
      }
      function clearErr() {
        errBox.textContent = "";
        errBox.classList.add("d-none");
      }
      function showToast(msg) {
        toastText.textContent = msg;
        toast.show();
      }

      function normalizeEcuadorPhone(input) {
        if (!input) return null;
        let s = String(input).trim();
        s = s.replaceAll(" ", "").replaceAll("-", "").replaceAll("(", "").replaceAll(")", "");

        if (s.startsWith("+")) s = s.slice(1);

        if (/^09\d{8}$/.test(s)) return "593" + s.slice(1);
        if (/^5939\d{8}$/.test(s)) return s;

        return null;
      }

      function inviteLink(qty) {
        const q = Math.min(3, Math.max(1, parseInt(qty, 10) || 1));
        return `invitacion.html?qty=${q}`;
      }

      function absoluteInviteLink(qty) {
        const rel = inviteLink(qty);
        try {
          return new URL(rel, window.location.href).toString();
        } catch {
          return rel;
        }
      }

      function updatePreview() {
        const qty = parseInt(qtySelect.value, 10) || 1;
        previewBadge.textContent = `${qty} persona${qty > 1 ? "s" : ""}`;
        previewFrame.src = inviteLink(qty);
      }

      async function copyText(text) {
        try {
          await navigator.clipboard.writeText(text);
          showToast("Copiado ‚úÖ");
        } catch {
          const ta = document.createElement("textarea");
          ta.value = text;
          document.body.appendChild(ta);
          ta.select();
          document.execCommand("copy");
          ta.remove();
          showToast("Copiado ‚úÖ");
        }
      }

      qtySelect.addEventListener("change", () => {
        clearErr();
        updatePreview();
      });

      copyBtn.addEventListener("click", async () => {
        clearErr();
        const qty = parseInt(qtySelect.value, 10) || 1;
        await copyText(absoluteInviteLink(qty));
      });

      openBtn.addEventListener("click", () => {
        clearErr();
        const qty = parseInt(qtySelect.value, 10) || 1;
        window.open(inviteLink(qty), "_blank", "noopener");
      });

      form.addEventListener("submit", (e) => {
        e.preventDefault();
        clearErr();

        const qty = parseInt(qtySelect.value, 10) || 1;
        const phone = normalizeEcuadorPhone(phoneInput.value);

        if (!phone) {
          showErr("N√∫mero inv√°lido. Usa 09xxxxxxxx o +593xxxxxxxxx");
          return;
        }

        const urlToSend = absoluteInviteLink(qty);
        const msg = (CONFIG.WA_MESSAGE_PREFIX || "Invitaci√≥n: ") + urlToSend;
        const wa = `https://wa.me/${phone}?text=${encodeURIComponent(msg)}`;

        window.open(wa, "_blank", "noopener");
      });

      updatePreview();
    })();
  </script>
</body>
</html>